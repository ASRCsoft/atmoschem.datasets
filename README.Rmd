---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ASRC Atmospheric Chemistry Data Processing

[![R build status](https://github.com/ASRCsoft/atmoschem.process/workflows/R-CMD-check/badge.svg)](https://github.com/ASRCsoft/atmoschem.process/actions)
[![Codecov test coverage](https://codecov.io/gh/ASRCsoft/atmoschem.process/branch/master/graph/badge.svg)](https://codecov.io/gh/ASRCsoft/atmoschem.process?branch=master)

The `atmoschem.process` R package processes atmospheric chemistry data from ASRC
sites in New York State. It provides tools to generate reports and processed
datasets from the ASRC's atmospheric chemistry data, and tools to visualize the
data.

## Table of contents

```{r toc, echo = FALSE, results = "asis", comment = ""}
readme = readLines('README.Rmd')
headers = readme[grepl('^## ', readme)][-1] # remove first header (toc)
titles = sub('^## ', '', headers)
links = paste0('#', gsub(' ', '-', tolower(titles)))
md_lines = paste0('- [', titles, '](', links, ')')
cat(paste(md_lines, collapse = '\n'))
```

## Installation

To install the package, run (from within R)

```R
install.packages('remotes')
remotes::install_github('ASRCsoft/atmoschem.process')
```

To generate the processed dataset, additional dependencies are requried:

```R
remotes::install_github('ASRCsoft/atmoschem.process', dependencies = TRUE)
```

## Reproducing the routine chemistry dataset

### Requirements

- Linux
- R and R package dependencies
- PostgreSQL, and a user with permission to create and delete databases

The processing is currently very computationally intensive and requires about
8GB of RAM and 30GB of disk space.

### Creating the dataset

Download or clone the repository. The dataset package can be generated by
running (from a terminal)

```sh
cd path/to/atmoschem.process
make routine_dataset
```

You will be asked for the atmoschem server's data password (twice), which can be
obtained from [the atmoschem website](http://atmoschem.asrc.cestm.albany.edu/).

### Viewing the data

The R package comes with a Shiny app for viewing the processing steps. After
data has been processed, it can be opened from within R:

```R
library(atmoschem.process)
# Create a postgres database connection and atmoschem.process dataset object
dbcon = src_postgres(dbname = 'nysatmoschemdb', user = 'user')
nysac = etl('atmoschem.process', db = dbcon, dir = 'data')
# Open the Shiny app
view_processing(nysac)
```

## Citation

The package citation can be obtained by running `citation('atmoschem.process')`:

```{r citation, echo = FALSE, comment=""}
citation('atmoschem.process')
```

## License

`atmoschem.process` is released under the open source MIT license.
