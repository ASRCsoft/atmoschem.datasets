---
output: github_document
bibliography: README.bib
link-citations: yes
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ASRC Atmospheric Chemistry Data Processing

[![R build status](https://github.com/ASRCsoft/atmoschem.process/workflows/R-CMD-check/badge.svg)](https://github.com/ASRCsoft/atmoschem.process/actions)
[![Codecov test coverage](https://codecov.io/gh/ASRCsoft/atmoschem.process/branch/master/graph/badge.svg)](https://codecov.io/gh/ASRCsoft/atmoschem.process?branch=master)

The `atmoschem.process` R package processes atmospheric chemistry data from ASRC
sites in New York State. It provides tools to generate reports and processed
datasets from the ASRC's atmospheric chemistry data, and tools to visualize the
data.

## Table of contents

```{r toc, echo = FALSE, results = "asis", comment = ""}
readme = readLines('README.Rmd')
headers = readme[grepl('^## ', readme)][-1] # remove first header (toc)
titles = sub('^## ', '', headers)
links = paste0('#', gsub(' ', '-', tolower(titles)))
md_lines = paste0('- [', titles, '](', links, ')')
cat(paste(md_lines, collapse = '\n'))
```

## Overview

The atmospheric chemistry group at the ASRC, run by Dr. Jim Schwab, collects
data from instruments at 4 sites across the state of New York: Whiteface
Mountain (summit and base), Pinnacle State Park, and Queens College. We maintain
a variety of instruments measuring ozone and ozone precursors, airborne
particulate matter, sulfur dioxide, and meteorology.

The data undergoes a variety of adjustments and quality assurance checks before
being released to the public, where it is used by government agencies and
atmospheric science researchers, among others. Users can access the datasets
online via our website at <http://atmoschem.asrc.cestm.albany.edu/>.

This software, which generates the processed datasets, synthesizes advice from
atmospheric monitoring, statistical programming, and data management. In terms
of data processing, we tend to follow guidelines from NARSTO
[@christensen_narsto_2000], and we also work regularly with EPA standards. The
code is organized as an R package [@marwick_packaging_2018], and we use GitHub
for project management [@bryan_excuse_2018]. For data management, we tend to
follow @briney_data_2015, and we try to make the data convenient to use
[@white_nine_2013].

The data collection at Whiteface Mountain is described in detail in a series of
publications [@schwab_atmospheric_2016; @brandt_atmospheric_2016;
@schwab_atmospheric_2016-1], and another paper describes the measurements at
Pinnacle State Park [@schwab_ozone_2009].

## Installation

To install the package, run (from within R)

```R
install.packages('remotes')
remotes::install_github('ASRCsoft/atmoschem.process')
```

To generate the processed dataset, additional dependencies are requried:

```R
remotes::install_github('ASRCsoft/atmoschem.process', dependencies = TRUE)
```

## Reproducing the routine chemistry dataset

### Requirements

- Linux
- R and R package dependencies
- PostgreSQL, and a user with permission to create and delete databases

The processing is currently very computationally intensive and requires about
8GB of RAM and 30GB of disk space.

### Creating the dataset

Download or clone the repository. The dataset package can be generated by
running (from a terminal)

```sh
cd path/to/atmoschem.process
make routine_dataset
```

You will be asked for the atmoschem server's data password (twice), which can be
obtained from [the atmoschem website](http://atmoschem.asrc.cestm.albany.edu/).

### Viewing the data

The R package comes with a Shiny app for viewing the processing steps. After
data has been processed, it can be opened from within R:

```R
library(atmoschem.process)
# Create a postgres database connection and atmoschem.process dataset object
dbcon = src_postgres(dbname = 'nysatmoschemdb', user = 'user')
nysac = etl('atmoschem.process', db = dbcon, dir = 'data')
# Open the Shiny app
view_processing(nysac)
```

## Citation

The package citation can be obtained by running `citation('atmoschem.process')`:

```{r citation, echo = FALSE, comment=""}
citation('atmoschem.process')
```

## License

`atmoschem.process` is released under the open source MIT license.

## References
